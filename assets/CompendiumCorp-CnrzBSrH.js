import{d as ne,g as ae,i as g,s as se,j as H,v as h,x as P,y as re,z as j,b as u,e as C,h as b,u as E,M as J,r as ie,o as d,f as n,t as m,H as ce,A as k,w as O,F as S,B as R,C as Q,I as Y,D as X,S as Z,l as y,E as ue,_ as de}from"./index-KKScdRr6.js";import{T as q}from"./TechList-M8Df3MCW.js";import{C as me,m as pe}from"./CompendiumPage-Bp2SvVCK.js";import{s as F}from"./capital_ships-BdRvDN1z.js";import{s as ve}from"./spacebuildings-CVaBZ2bu.js";import{m as w}from"./ModulePage.vue_vue_type_script_setup_true_lang-DSm0NpjV.js";import{o as fe}from"./Data-BKl5GaN3.js";import"./byTypes-DiOuyN-I.js";import"./Page-Cia_DmrK.js";import"./globals-CXCjQ2-e.js";import"./sec2str-CJPGO1m_.js";const ge={class:"select corp-switch"},he=["value"],Ce={style:{position:"absolute",top:"-35px",right:"0","font-size":"10px",color:"yellow","line-height":"1.2"}},_e={class:"container"},Ie={class:"select"},Ee=["disabled"],ye=["value"],Te=["onClick"],be={class:"meta"},Se={class:"avatar"},Re=["src","alt"],Le={class:"sort-tech"},Me=["k"],Oe={class:"modal-filter-tech"},we={class:"sections-group other"},Ae={class:"type",name:"user-info"},Ne=["onClick"],De=5,B=100,Ue=ne({__name:"CompendiumCorp",setup(Pe){var V;const L=se(),{t:K}=ae(),W=K("HS_COMPENDIUM"),x=(V=new Intl.Locale(navigator.language))==null?void 0:V.hourCycles,ee=x?["h23","h24"].some(e=>x.includes(e)):!0,p={LocalTime:{icon:{name:"time",dir:"icons/compendium"},formatter:({localTime:e,localTime24:t})=>ee?t:e},AfkFor:{icon:{name:"afk",dir:"icons/compendium"},formatter:({afkFor:e})=>e},CargoCap:{icon:{name:"cargo",dir:"icons/compendium"},formatter:({tech:e})=>{let t=0;const[a]=e[y("Transport")]||[],[o]=e[y("TransportCapacity")]||[],[l]=e[y("RelicDrone")]||[];return a&&o&&(t+=F.Transport.JobCapacity[a-1]+w.TransportCapacity.ExtraTradeSlots[o-1]),l&&(t+=w.RelicDrone.drone.JobCapacity[l-1]),t}}},T=g(!1),A=g(!1),N=g(!1),I=g(L.state.userSettings.compendiumCorpLastRoleId),c=H([]),_=g({}),v=g([]),i=g([]),s=g(""),M=H({title:"",lvlMap:void 0});let f=[];v.value=Array.from({length:10},e=>({userId:e,name:"",avatarUrl:""})),h.value.on("connected",async()=>{console.log("ðŸ”— Client connected, loading corporations..."),await $(),s.value&&await D()}),h.value.on("disconnected",()=>{f=[],v.value=Array.from({length:10},e=>({userId:e,name:"",avatarUrl:""})),I.value="",c.splice(0),i.value=[],s.value="",L.commit(P.SET_COMPENDIUM_CORP_LAST_ROLE_ID)}),re(async()=>{h.value.getUser()&&(console.log("ðŸ“± Component mounted, loading corporations..."),await $(),s.value&&await D())}),j(I,async e=>{var t;if(console.log("ðŸ” Role filter changed to:",e,"(type:",typeof e,"length:",(e==null?void 0:e.length)+")"),L.commit(P.SET_COMPENDIUM_CORP_LAST_ROLE_ID,e),s.value){const a=(t=_.value.roles)==null?void 0:t.find(r=>r.id===e),o=(a==null?void 0:a.name)==="@everyone",l=o?null:e;console.log("ðŸ“¡ [ROLE FILTER REQUEST] corpId:",s.value,"roleId:",l,"(selected role:",(a==null?void 0:a.name)+")"),T.value=!0;try{const r=await h.value.corpdata({corpId:s.value,roleId:l});console.log("ðŸ“¥ [ROLE FILTER RESPONSE] Filtered data received:",r),f=r.members,v.value=f.slice(0,B),o&&(I.value="",console.log("ðŸ”„ @everyone role selected, resetting filter to show all roles"))}catch(r){console.error("âŒ Error fetching role-filtered data:",r)}T.value=!1}G(c)}),j(()=>c,G,{deep:!0});async function $(){try{console.log("ðŸ”„ Loading corporations..."),console.log("Client connected:",!!h.value.getUser());const e=await h.value.getUserCorporations();if(console.log("âœ… Corporations loaded:",e.corporations),console.log("User info:",e.user),i.value=e.corporations,i.value.length>0&&!s.value){await new Promise(a=>setTimeout(a,200));const t=h.value.getGuild();if(console.log("ðŸ° Current guild:",t),t){const a=i.value.find(o=>o.id===t.id||o.name===t.name);a?(s.value=a.id,console.log("ðŸŽ¯ Auto-selected corporation based on guild:",a.name,"(id:",a.id+")")):(s.value=i.value[0].id,console.log("âš ï¸ Guild found but no matching corporation, selected first:",i.value[0].name))}else s.value=i.value[0].id,console.log("âš ï¸ No guild available, selected first corporation:",i.value[0].name)}else i.value.length===0&&console.warn("âš ï¸ No corporations found for user")}catch(e){console.error("âŒ Error loading corporations:",e),console.error("Error details:",e.message,e.stack),i.value=[]}}async function oe(){console.log("ðŸ¢ Corporation changed to:",s.value),console.log("Available corporations:",i.value.map(e=>`${e.id}: ${e.name}`)),I.value="",L.commit(P.SET_COMPENDIUM_CORP_LAST_ROLE_ID,""),await D()}async function D(){if(!s.value){console.log("â­ï¸ No corporation selected, skipping fetch");return}console.log("ðŸ“¡ [CORPORATION REQUEST] Fetching data with corpId:",s.value,"and roleId: null"),T.value=!0;try{const e=await h.value.corpdata({corpId:s.value,roleId:null});console.log("ðŸ“¥ [CORPORATION RESPONSE] Data received for corporation:",s.value),console.log("Roles:",e.roles),console.log("Members count:",e.members.length),_.value=e,f=e.members,v.value=e.members.slice(0,B)}catch(e){console.error("âŒ Error fetching corporation data:",e),f=[],v.value=[]}T.value=!1}async function z(e){U(e.Name)?c.splice(c.indexOf(e.Name),1):c.push(e.Name)}function U(e){return c.includes(e)}function te(e){f.length&&(M.title=e.name,M.lvlMap=fe(e.tech,{map:([t,a])=>[ue(t),a[0]]}),N.value=!0)}function G(e){v.value=f.sort((t,a)=>{var o,l;return e.length&&!(e[0]in p)?(((o=a.tech[y(e[0])])==null?void 0:o[0])||0)-(((l=t.tech[y(e[0])])==null?void 0:l[0])||0):e[0]=="CargoCap"?p.CargoCap.formatter(a)-p.CargoCap.formatter(t):0}).slice(0,B)}function le(e){if(!c.length)return{};const t={},a=Object.fromEntries(c.map(o=>{var l;return o in p?[o,p[o].formatter(e)]:[o,(l=e.tech[y(o)])==null?void 0:l[0]]}).slice(De*-1));for(const o in a){const l=t[o]={icon:{dir:"",name:""},level:a[o]};o in w?(l.icon.dir="game/Modules",l.icon.name=w[o].Icon):o in F?(l.icon.dir="game/Ships",l.icon.name=F[o].Model[5]):o in p?l.icon=p[o].icon:(l.icon.dir="game/SpaceBuildings",l.icon.name=ve[o].PrefabModel)}return t}return(e,t)=>{const a=ie("t");return d(),u("div",null,[C(E(ce),null,{default:b(()=>[n("title",null,m(E(W)),1)]),_:1}),C(me,null,{"custom-selector":b(()=>{var o,l;return[n("div",ge,[O(n("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.value=r),onChange:oe},[(d(!0),u(S,null,R(i.value,r=>(d(),u("option",{key:r.id,value:r.id},m(r.name),9,he))),128))],544),[[Q,s.value]]),n("div",Ce,[X(" Corps: "+m(i.value.length)+" | Selected: "+m(s.value),1),t[7]||(t[7]=n("br",null,null,-1)),X(" Roles: "+m(((o=_.value.roles)==null?void 0:o.length)||0)+" | Members: "+m(((l=_.value.members)==null?void 0:l.length)||0),1)])])]}),default:b(()=>[n("div",_e,[n("div",{class:k(["filter",{disable:v.value.length>E(f).length}])},[n("div",null,[O(n("button",{class:"btn-tech-filter",onClick:t[1]||(t[1]=o=>A.value=!0)},null,512),[[a,"FILTER"]])]),n("div",Ie,[O(n("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>I.value=o),disabled:!_.value.roles||_.value.roles.length===0},[(d(!0),u(S,null,R(_.value.roles,o=>(d(),u("option",{key:o.id,value:o.id},m(o.name),9,ye))),128))],8,Ee),[[Q,I.value]])])],2),n("ul",{class:k(["members-list",{"animated-fetch":T.value}])},[(d(!0),u(S,null,R(v.value,o=>(d(),u("li",{key:o.userId,class:"member",onClick:l=>te(o)},[n("div",be,[n("div",Se,[n("img",{src:o.avatarUrl,alt:`${o.name} avatar`,onError:t[3]||(t[3]=l=>l.target.src=E(pe))},null,40,Re)]),n("p",null,m(o.name),1)]),n("div",Le,[n("ul",null,[(d(!0),u(S,null,R(le(o),(l,r)=>(d(),u("li",{key:r},[n("div",null,[C(Y,{name:l.icon.name,dir:l.icon.dir},null,8,["name","dir"]),n("span",{k:r,class:"level"},m(l.level),9,Me)])]))),128))])])],8,Te))),128))],2)])]),_:1}),C(J,{open:A.value,"onUpdate:open":t[5]||(t[5]=o=>A.value=o),title:e.$t("FILTER"),size:E(Z).LARGE},{body:b(()=>[n("div",Oe,[n("button",{class:"button accent",onClick:t[4]||(t[4]=o=>c.splice(0))},m(e.$t("RESET_ALL")),1),n("div",we,[n("section",Ae,[O(n("h3",null,null,512),[[a,"TID_OBJECT_ACTION_PLAYER_INFO"]]),n("ul",null,[(d(),u(S,null,R(p,({icon:o},l)=>n("li",{key:l,class:"item"},[n("div",{class:k({mute:U(l)}),onClick:()=>z({Name:l})},[C(Y,{name:o.name,dir:o.dir},null,8,["name","dir"])],10,Ne)])),64))])])]),C(q,{"on-click":z,"is-muted":U})])]),_:1},8,["open","title","size"]),C(J,{open:N.value,"onUpdate:open":t[6]||(t[6]=o=>N.value=o),title:M.title,size:E(Z).LARGE},{body:b(()=>[C(q,{"level-map":M.lvlMap},null,8,["level-map"])]),_:1},8,["open","title","size"])])}}}),Qe=de(Ue,[["__scopeId","data-v-66010f6b"]]);export{Qe as default};
